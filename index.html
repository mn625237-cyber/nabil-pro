<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0a0f1e">
<title>Nabil Pro ğŸ›µ</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
:root {
  --bg: #0a0f1e; --bg2: #111827; --bg3: #1a2236; --card: rgba(17,24,39,0.95);
  --text: #f1f5f9; --text2: #64748b; --primary: #f97316; --success: #22c55e;
  --danger: #ef4444; --visa: #818cf8; --radius: 18px; --nav-h: 68px; --header-h: 62px;
}
body { font-family: 'Cairo', sans-serif; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }
.header { position: fixed; top: 0; inset-x: 0; height: var(--header-h); background: var(--bg2); display: flex; align-items: center; justify-content: space-between; padding: 0 16px; z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.05); }
.swipe-container { position: fixed; top: var(--header-h); bottom: var(--nav-h); inset-x: 0; overflow: hidden; }
.pages-wrapper { display: flex; width: 400%; height: 100%; transition: transform 0.3s ease; }
.page { width: 25%; height: 100%; overflow-y: auto; padding: 16px; padding-bottom: 30px; }
.card { background: var(--card); border-radius: var(--radius); padding: 16px; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.05); }
.stat-card { background: var(--card); border-radius: var(--radius); padding: 12px; border-bottom: 3px solid var(--primary); }
.bottom-nav { position: fixed; bottom: 0; inset-x: 0; height: var(--nav-h); background: var(--bg2); display: grid; grid-template-columns: repeat(4, 1fr); border-top: 1px solid rgba(255,255,255,0.05); }
.nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: var(--text2); font-weight: bold; }
.nav-item.active { color: var(--primary); }
.btn-primary { background: linear-gradient(135deg, var(--primary), #fb923c); color: white; padding: 14px; border-radius: 12px; width: 100%; font-weight: 800; }
.firebase-status { display: flex; align-items: center; gap: 8px; padding: 10px; border-radius: 12px; font-size: 12px; font-weight: bold; margin-bottom: 12px; background: rgba(34,197,94,0.1); color: var(--success); }
.input-voice-row { display: flex; gap: 8px; margin-bottom: 12px; }
.form-input { flex: 1; background: var(--bg3); border: 1px solid rgba(255,255,255,0.1); padding: 12px; border-radius: 10px; color: white; outline: none; }
.voice-btn { width: 45px; background: var(--bg3); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
.order-card { background: var(--bg2); border-radius: 15px; padding: 12px; margin-bottom: 10px; border-right: 4px solid var(--primary); }
</style>
</head>
<body>

<div class="header">
    <div class="flex items-center gap-2">
        <span class="text-orange-500 text-xl font-black">Nabil Pro</span>
    </div>
    <div id="fbStatus" class="firebase-status">ğŸŸ¢ Ù…ØªØµÙ„ ÙˆØ³Ø­Ø§Ø¨ÙŠ</div>
</div>

<div class="swipe-container">
    <div class="pages-wrapper" id="pagesWrapper">
        <!-- Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div class="page">
            <div class="card bg-gradient-to-br from-orange-900/20 to-transparent">
                <p class="text-xs text-orange-400">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù†Ø§Ø¨Ù„ ğŸ‘‹</p>
                <h2 id="welcomeTime" class="text-4xl font-black mt-1 tracking-tighter">00:00</h2>
            </div>
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="stat-card">
                    <p class="text-[10px] opacity-60">Ø£ÙˆØ±Ø¯Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                    <p id="stat-orders" class="text-2xl font-black">0</p>
                </div>
                <div class="stat-card" style="border-color: var(--success);">
                    <p class="text-[10px] opacity-60">Ø£Ø±Ø¨Ø§Ø­Ùƒ</p>
                    <p id="stat-profit" class="text-2xl font-black">0 Ø¬</p>
                </div>
            </div>
            <h3 class="font-bold mb-3 flex items-center gap-2">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</h3>
            <div id="shiftReport" class="card text-sm">Ù„Ø§ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>
        </div>

        <!-- Ø£ÙˆØ±Ø¯Ø± Ø¬Ø¯ÙŠØ¯ -->
        <div class="page">
            <h3 class="font-bold mb-4">â• Ø£ÙˆØ±Ø¯Ø± Ø¬Ø¯ÙŠØ¯</h3>
            <div class="card">
                <div class="input-voice-row">
                    <input id="inp-address" type="text" placeholder="ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" class="form-input">
                    <button class="voice-btn" onclick="startVoice('inp-address')">ğŸ™ï¸</button>
                </div>
                <div class="input-voice-row">
                    <input id="inp-phone" type="tel" placeholder="ğŸ“± Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„" class="form-input">
                    <button class="voice-btn" onclick="startVoice('inp-phone')">ğŸ™ï¸</button>
                </div>
                <input id="inp-total" type="number" placeholder="ğŸ’° Ø«Ù…Ù† Ø§Ù„Ø£ÙˆØ±Ø¯Ø± Ø§Ù„ÙƒÙ„ÙŠ" class="form-input w-full mb-3">
                <input id="inp-delivery" type="number" placeholder="ğŸ›µ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„" class="form-input w-full mb-6">
                <button onclick="saveOrder()" class="btn-primary">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±</button>
            </div>
        </div>

        <!-- Ø§Ù„Ø³Ø¬Ù„Ø§Øª -->
        <div class="page">
            <h3 class="font-bold mb-4">ğŸ“‹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h3>
            <div id="ordersList"></div>
        </div>

        <!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
        <div class="page">
            <h3 class="font-bold mb-4">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
            <div class="card">
                <p class="text-sm opacity-60">Ù‡ÙˆÙŠØ© Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø«Ø§Ø¨ØªØ©:</p>
                <code class="text-xs text-orange-400">nabil_pro_official</code>
            </div>
            <button class="btn-primary bg-red-600 mt-4" onclick="clearData()">ğŸ—‘ï¸ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
    </div>
</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="goPage(0)">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <div class="nav-item" onclick="goPage(1)">â• Ø£ÙˆØ±Ø¯Ø±</div>
    <div class="nav-item" onclick="goPage(2)">ğŸ“‹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
    <div class="nav-item" onclick="goPage(3)">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
</nav>

<script>
const FIREBASE_CONFIG = {
  apiKey: "AIzaSyAikfw9vS3PJQgaWl6SrpcOSG34B5vyXPc",
  authDomain: "nabil-pro.firebaseapp.com",
  projectId: "nabil-pro",
  storageBucket: "nabil-pro.firebasestorage.app",
  messagingSenderId: "82099030853",
  appId: "1:82099030853:web:89de9eabad2cc53817cc2c"
};

firebase.initializeApp(FIREBASE_CONFIG);
const db = firebase.firestore();
const DRIVER_ID = "nabil_pro_official";

function goPage(idx) {
    document.getElementById('pagesWrapper').style.transform = `translateX(${idx * 25}%)`;
    document.querySelectorAll('.nav-item').forEach((item, i) => {
        item.classList.toggle('active', i === idx);
    });
}

async function saveOrder() {
    const address = document.getElementById('inp-address').value;
    const phone = document.getElementById('inp-phone').value;
    const total = parseFloat(document.getElementById('inp-total').value);
    const delivery = parseFloat(document.getElementById('inp-delivery').value);
    
    if(!address || !total || !delivery) return alert("Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

    await db.collection('orders').add({
        address, phone, total, delivery,
        restAmount: total - delivery,
        driverId: DRIVER_ID,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
    
    alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸!");
    document.querySelectorAll('.form-input').forEach(i => i.value = '');
    goPage(0);
}

db.collection('orders').where('driverId', '==', DRIVER_ID).orderBy('timestamp', 'desc').onSnapshot(snap => {
    const orders = snap.docs.map(d => ({id: d.id, ...d.data()}));
    const today = new Date().toDateString();
    const todayOrders = orders.filter(o => o.timestamp && new Date(o.timestamp.toDate()).toDateString() === today);

    document.getElementById('stat-orders').innerText = todayOrders.length;
    document.getElementById('stat-profit').innerText = todayOrders.reduce((s,o)=>s+(o.delivery||0), 0) + " Ø¬";
    
    document.getElementById('shiftReport').innerHTML = `
        <div class="flex justify-between py-1"><span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­ØµÙŠÙ„:</span> <b>${todayOrders.reduce((s,o)=>s+(o.total||0), 0)} Ø¬</b></div>
        <div class="flex justify-between py-1 border-t border-white/5 mt-1 pt-1 text-orange-400"><span>ØµØ§ÙÙŠ Ø£Ø±Ø¨Ø§Ø­Ùƒ:</span> <b>${todayOrders.reduce((s,o)=>s+(o.delivery||0), 0)} Ø¬</b></div>
    `;

    document.getElementById('ordersList').innerHTML = orders.map(o => `
        <div class="order-card">
            <div class="flex justify-between mb-1 font-bold"><span>ğŸ“ ${o.address}</span> <span>${o.delivery} Ø¬</span></div>
            <div class="text-[10px] opacity-50">ğŸ“± ${o.phone || 'Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù…'} | ÙƒÙ„ÙŠ: ${o.total}Ø¬</div>
        </div>
    `).join('');
});

function startVoice(id) {
    const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    rec.lang = 'ar-EG';
    rec.onresult = (e) => document.getElementById(id).value = e.results[0][0].transcript;
    rec.start();
}

setInterval(() => {
    document.getElementById('welcomeTime').innerText = new Date().toLocaleTimeString('ar-EG', {hour:'2-digit', minute:'2-digit'});
}, 1000);

function clearData() {
    if(confirm("Ù…ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ø¹Ø§ÙŠØ² ØªÙ…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ")) {
        db.collection('orders').where('driverId', '==', DRIVER_ID).get().then(snap => {
            snap.forEach(doc => doc.ref.delete());
        });
    }
}
</script>
</body>
    </html>
